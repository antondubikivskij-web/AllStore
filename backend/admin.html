<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllStore - Адмін-панель</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; color: #e2e8f0; }
        .admin-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .admin-header { text-align: center; margin-bottom: 40px; padding: 20px; background: rgba(30, 41, 59, 0.8); border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid #334155; }
        .admin-header h1 { font-size: 2.5rem; margin-bottom: 10px; color: #fbbf24; }
        .admin-tabs { display: flex; justify-content: center; margin-bottom: 30px; gap: 10px; flex-wrap: wrap; }
        .tab-btn { padding: 12px 24px; background: rgba(30, 41, 59, 0.8); border: 2px solid #fbbf24; color: #fbbf24; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; }
        .tab-btn:hover, .tab-btn.active { background: #fbbf24; color: #0f172a; }
        .admin-content { background: rgba(30, 41, 59, 0.8); border-radius: 15px; padding: 30px; backdrop-filter: blur(10px); min-height: 500px; border: 1px solid #334155; }
        .login-form { max-width: 400px; margin: 0 auto; text-align: center; }
        .form-group { margin-bottom: 20px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 15px; border: 2px solid #fbbf24; border-radius: 10px; background: rgba(30, 41, 59, 0.8); color: #e2e8f0; font-size: 16px; }
        .login-btn, .submit-btn { width: 100%; padding: 15px; background: #fbbf24; color: #0f172a; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .login-btn:hover, .submit-btn:hover { background: #f59e0b; transform: translateY(-2px); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(30, 41, 59, 0.8); padding: 25px; border-radius: 15px; text-align: center; border: 2px solid #fbbf24; }
        .stat-card i { font-size: 2.5rem; color: #fbbf24; margin-bottom: 15px; }
        .stat-card h3 { font-size: 2rem; margin-bottom: 10px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { background: rgba(30, 41, 59, 0.8); border-radius: 15px; padding: 20px; border: 2px solid #fbbf24; position: relative; }
        .product-card h4 { color: #fbbf24; margin-bottom: 10px; }
        .product-card p { color: #e2e8f0; margin-bottom: 8px; font-size: 14px; }
        .product-actions { display: flex; gap: 10px; margin-top: 15px; }
        .edit-btn, .delete-btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; }
        .edit-btn { background: #10b981; color: white; }
        .delete-btn { background: #ef4444; color: white; }
        .alert { padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .alert-success { background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; color: #10b981; }
        .alert-error { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; color: #ef4444; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } .admin-tabs { flex-direction: column; align-items: center; } }
    </style>
</head>
<body>
    <div class="admin-container">
        <div id="loginSection">
            <div class="admin-header">
                <h1><i class="fas fa-shield-alt"></i> AllStore Адмін</h1>
                <p>Панель управління магазином</p>
            </div>
            <div class="admin-content">
                <form class="login-form" id="loginForm">
                    <h2><i class="fas fa-sign-in-alt"></i> Вхід в систему</h2>
                    <div class="form-group">
                        <input type="text" id="username" placeholder="Ім'я користувача" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="password" placeholder="Пароль" required>
                    </div>
                    <button type="submit" class="login-btn">Увійти</button>
                </form>
            </div>
        </div>

        <div id="dashboardSection" style="display: none;">
            <div class="admin-header">
                <h1><i class="fas fa-cogs"></i> Панель управління</h1>
                <p>Керування сайтом та товарами</p>
            </div>

            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('dashboard')">Дашборд</button>
                <button class="tab-btn" onclick="showTab('products')">Товари</button>
                <button class="tab-btn" onclick="showTab('categories')">Категорії</button>
                <button class="tab-btn" onclick="showTab('orders')">Замовлення</button>
            </div>

            <div id="dashboardTab" class="admin-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-box"></i>
                        <h3 id="totalProducts">0</h3>
                        <p>Товарів</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart"></i>
                        <h3 id="totalOrders">0</h3>
                        <p>Замовлень</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-money-bill"></i>
                        <h3 id="totalRevenue">0 ₴</h3>
                        <p>Виручка</p>
                    </div>
                </div>
            </div>

            <div id="productsTab" class="admin-content" style="display: none;">
                <h3>Управління товарами</h3>
                <form id="addProductForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Назва товару</label>
                            <input type="text" id="productName" required>
                        </div>
                        <div class="form-group">
                            <label>Ціна (₴)</label>
                            <input type="number" id="productPrice" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Категорія</label>
                            <select id="productCategory">
                                <option value="">Виберіть категорію</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Підкатегорія</label>
                            <input type="text" id="productSubcategory" placeholder="Наприклад: Футболки, Джинси">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Залишок</label>
                            <input type="number" id="productStock" value="0">
                        </div>
                        <div class="form-group">
                            <label>Знижка (%)</label>
                            <input type="number" id="productDiscount" value="0" min="0" max="99">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>URL основного зображення</label>
                        <input type="url" id="productImage" placeholder="https://example.com/photo1.jpg">
                    </div>
                    <div class="form-group">
                        <label>Додаткові фото (по одному URL на рядок)</label>
                        <textarea id="productImages" rows="4" placeholder="https://example.com/photo2.jpg&#10;https://example.com/photo3.jpg&#10;https://example.com/photo4.jpg"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Опис</label>
                        <textarea id="productDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Характеристики (кожна з нового рядка)</label>
                        <textarea id="productSpecifications" rows="4" placeholder="Розмір: L&#10;Матеріал: Бавовна 100%&#10;Виробник: Туреччина"></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Додати товар</button>
                </form>
                <div id="productsList" class="products-grid"></div>
            </div>

            <div id="categoriesTab" class="admin-content" style="display: none;">
                <h3>Управління категоріями</h3>
                <div class="form-group">
                    <input type="text" id="newCategoryName" placeholder="Назва категорії">
                    <button onclick="addCategory()" class="submit-btn">Додати категорію</button>
                </div>
                <div id="categoriesList"></div>
            </div>

            <div id="ordersTab" class="admin-content" style="display: none;">
                <h3>Управління замовленнями</h3>
                <div id="ordersList"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        let isLoggedIn = false;

        // Логин
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_BASE_URL}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    isLoggedIn = true;
                    showDashboard();
                    loadStats();
                } else {
                    showAlert('Невірні облікові дані', 'error');
                }
            } catch (error) {
                showAlert('Помилка входу', 'error');
            }
        });

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
        }

        function showTab(tabName) {
            document.querySelectorAll('.admin-content').forEach(content => content.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            if (tabName === 'dashboard') {
                document.getElementById('dashboardTab').style.display = 'block';
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            } else if (tabName === 'products') {
                document.getElementById('productsTab').style.display = 'block';
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                loadProducts();
                loadCategoriesForSelect();
            } else if (tabName === 'categories') {
                document.getElementById('categoriesTab').style.display = 'block';
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                loadCategories();
            } else if (tabName === 'orders') {
                document.getElementById('ordersTab').style.display = 'block';
                document.querySelectorAll('.tab-btn')[3].classList.add('active');
                loadOrders();
            }
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/stats`);
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('totalProducts').textContent = stats.total_products || 0;
                    document.getElementById('totalOrders').textContent = stats.total_orders || 0;
                    document.getElementById('totalRevenue').textContent = `${stats.total_revenue || 0} ₴`;
                }
            } catch (error) {
                console.error('Помилка завантаження статистики:', error);
            }
        }

        async function loadCategoriesForSelect() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    const select = document.getElementById('productCategory');
                    select.innerHTML = '<option value="">Виберіть категорію</option>';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Помилка завантаження категорій:', error);
            }
        }

        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Обрабатываем множественные фото
            const additionalImages = document.getElementById('productImages').value
                .split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);
            
            const productData = {
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value),
                category: document.getElementById('productCategory').value,
                subcategory: document.getElementById('productSubcategory').value,
                stock: parseInt(document.getElementById('productStock').value) || 0,
                image: document.getElementById('productImage').value,
                images: additionalImages,
                description: document.getElementById('productDescription').value,
                specifications: document.getElementById('productSpecifications').value,
                discount: parseFloat(document.getElementById('productDiscount').value) || 0
            };

            try {
                const response = await fetch(`${API_BASE_URL}/admin/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });

                if (response.ok) {
                    showAlert('Товар додано!', 'success');
                    document.getElementById('addProductForm').reset();
                    loadProducts();
                    loadStats();
                } else {
                    showAlert('Помилка додавання товару', 'error');
                }
            } catch (error) {
                showAlert('Помилка додавання товару', 'error');
            }
        });

        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                if (response.ok) {
                    const products = await response.json();
                    displayProducts(products);
                }
            } catch (error) {
                console.error('Помилка завантаження товарів:', error);
            }
        }

        function displayProducts(products) {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                // Обрабатываем множественные фото
                const allImages = [];
                if (product.image) allImages.push(product.image);
                if (product.images) {
                    const additionalImages = product.images.split(',').map(url => url.trim()).filter(url => url.length > 0);
                    allImages.push(...additionalImages);
                }
                
                const imagesHtml = allImages.length > 0 ? 
                    `<div style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;">
                        ${allImages.map((img, index) => 
                            `<img src="${img}" alt="Фото ${index + 1}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 5px;" onerror="this.style.display='none'">`
                        ).join('')}
                    </div>` : '';
                
                productCard.innerHTML = `
                    ${imagesHtml}
                    <h4>${product.name}</h4>
                    <p><strong>Ціна:</strong> ${product.price} ₴</p>
                    <p><strong>Категорія:</strong> ${product.category || 'Не вказано'}</p>
                    <p><strong>Підкатегорія:</strong> ${product.subcategory || 'Не вказано'}</p>
                    <p><strong>Залишок:</strong> ${product.stock || 0} шт.</p>
                    ${product.discount > 0 ? `<p><strong>Знижка:</strong> ${product.discount}%</p>` : ''}
                    <p><strong>Опис:</strong> ${product.description || 'Без опису'}</p>
                    ${product.specifications ? `<p><strong>Характеристики:</strong> ${product.specifications.replace(/\n/g, ', ')}</p>` : ''}
                    <p><strong>Фото:</strong> ${allImages.length} шт.</p>
                    <div class="product-actions">
                        <button class="delete-btn" onclick="deleteProduct(${product.id})">Видалити</button>
                    </div>
                `;
                productsList.appendChild(productCard);
            });
        }

        async function deleteProduct(productId) {
            if (!confirm('Ви впевнені?')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/admin/products/${productId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showAlert('Товар видалено!', 'success');
                    loadProducts();
                    loadStats();
                } else {
                    showAlert('Помилка видалення товару', 'error');
                }
            } catch (error) {
                showAlert('Помилка видалення товару', 'error');
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    const categoriesList = document.getElementById('categoriesList');
                    categoriesList.innerHTML = categories.map(category => 
                        `<div style="padding: 10px; margin: 5px; background: rgba(30, 41, 59, 0.8); border-radius: 8px;">${category}</div>`
                    ).join('');
                }
            } catch (error) {
                console.error('Помилка завантаження категорій:', error);
            }
        }

        async function addCategory() {
            const categoryName = document.getElementById('newCategoryName').value.trim();
            if (!categoryName) return;

            try {
                const response = await fetch(`${API_BASE_URL}/admin/categories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: categoryName })
                });

                if (response.ok) {
                    showAlert('Категорія додана!', 'success');
                    document.getElementById('newCategoryName').value = '';
                    loadCategories();
                } else {
                    showAlert('Помилка додавання категорії', 'error');
                }
            } catch (error) {
                showAlert('Помилка додавання категорії', 'error');
            }
        }

        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/orders`);
                if (response.ok) {
                    const orders = await response.json();
                    const ordersList = document.getElementById('ordersList');
                    ordersList.innerHTML = orders.map(order => `
                        <div style="padding: 20px; margin: 10px; background: rgba(30, 41, 59, 0.8); border-radius: 15px;">
                            <h4>Замовлення #${order.id}</h4>
                            <p><strong>Клієнт:</strong> ${order.customer_name}</p>
                            <p><strong>Телефон:</strong> ${order.customer_phone}</p>
                            <p><strong>Сума:</strong> ${order.total_amount} ₴</p>
                            <p><strong>Статус:</strong> ${order.status}</p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Помилка завантаження замовлень:', error);
            }
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            document.querySelector('.admin-container').insertBefore(alert, document.querySelector('.admin-container').firstChild);
            setTimeout(() => alert.remove(), 3000);
        }
    </script>
</body>
</html>
